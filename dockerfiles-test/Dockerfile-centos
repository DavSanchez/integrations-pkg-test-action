FROM pgallina/centos-test as centos-test

ARG INTEGRATION=nri-apache
ARG TAG=0.0.1
ARG TEST_EXISTENCE=""
ARG TEST_UPDATE=false

ADD ./dist ./dist

RUN echo "centos-test-test for ${INTEGRATION} ${TAG}"
RUN if [[ "${TEST_UPDATE}" = true ]] ; then yum -y install ${INTEGRATION} ; fi
RUN yum -y install ./dist/${INTEGRATION}-${TAG}-1.x86_64.rpm

RUN ls $TEST_EXISTENCE
RUN /var/db/newrelic-infra/newrelic-integrations/bin/${INTEGRATION} -show_version | grep ${TAG}
